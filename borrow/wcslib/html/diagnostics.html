<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>WCSLIB 4.13.4: Diagnostic output</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.6 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="index.html">WCSLIB 4.13.4 and PGSBOX 4.13.4</a>
  </div>
</div>
<div class="contents">
<h1><a class="anchor" name="diagnostics">Diagnostic output </a></h1>All <a class="el" href="overview.html">WCSLIB</a> functions return a status value, each of which is associated with a fixed error message which may be used for diagnostic output. For example <div class="fragment"><pre class="fragment">
  int status;
  struct wcsprm wcs;

  ...

  if ((status = wcsset(&amp;wcs)) {
    fprintf(stderr, "ERROR %d from wcsset(): %s.\n", status, wcs_errmsg[status]);
    return status;
  }
</pre></div> This might produce output like <div class="fragment"><pre class="fragment">
ERROR 5 from wcsset(): Invalid parameter value.
</pre></div> The error messages are provided as global variables with names of the form <em>cel_errmsg</em>, <em>prj_errmsg</em>, etc. by including the relevant header file.<p>
As of version 4.8, courtesy of Michael Droettboom <a class="el" href="software.html">(pywcs)</a>, WCSLIB has a second error messaging system which provides more detailed information about errors, including the function, source file, and line number where the error occurred. For example, <div class="fragment"><pre class="fragment">
  struct wcsprm wcs;

  /* Enable wcserr and send messages to stderr. */
  wcserr_enable(1);
  wcsprintf_set(stderr);

  ...

  if (wcsset(&amp;wcs) {
    wcsperr(&amp;wcs);
    return wcs.err-&gt;status;
  }
</pre></div> In this example, if an error was generated in one of the <a class="el" href="prj_8h.html#d43dbc765c63162d0af2b9285b8a434f" title="Generic setup routine for the prjprm struct.">prjset()</a> functions, <a class="el" href="wcs_8h.html#8fe5dcd9927240dc0348b850ee662367" title="Print error messages from a wcsprm struct.">wcsperr()</a> would print an error traceback starting with <a class="el" href="wcs_8h.html#e5cc3f5d249755583403cdf54d2ebb91" title="Setup routine for the wcsprm struct.">wcsset()</a>, then <a class="el" href="cel_8h.html#b0f67d1727750616f71c7bfcb3a037b6" title="Setup routine for the celprm struct.">celset()</a>, and finally the particular projection-setting function that generated the error. For each of them it would print the status return value, function name, source file, line number, and an error message which may be more specific and informative than the general error messages reported in the first example. For example, in response to a deliberately generated error, the <code>twcs</code> test program, which tests <a class="el" href="structwcserr.html" title="Error message handling.">wcserr</a> among other things, produces a traceback similar to this: <div class="fragment"><pre class="fragment">
ERROR 5 in wcsset() at line 1564 of file wcs.c:
  Invalid parameter value.
ERROR 2 in celset() at line 196 of file cel.c:
  Invalid projection parameters.
ERROR 2 in bonset() at line 5727 of file prj.c:
  Invalid parameters for Bonne's projection.
</pre></div><p>
Each of the <a class="el" href="structs.html">structs</a> in <a class="el" href="overview.html">WCSLIB</a> includes a pointer, called <em>err</em>, to a <a class="el" href="structwcserr.html" title="Error message handling.">wcserr</a> struct. When an error occurs, a struct is allocated and error information stored in it. The <a class="el" href="structwcserr.html" title="Error message handling.">wcserr</a> pointers and the <a class="el" href="memory.html">memory</a> allocated for them are managed by the routines that manage the various structs such as <a class="el" href="wcs_8h.html#2afc8255fde0965dddaa374463666d45" title="Default constructor for the wcsprm struct.">wcsini()</a> and <a class="el" href="wcs_8h.html#4ab38bc642c4656f62c43acf84a849f1" title="Destructor for the wcsprm struct.">wcsfree()</a>.<p>
<a class="el" href="structwcserr.html" title="Error message handling.">wcserr</a> messaging is an opt-in system enabled via <a class="el" href="wcserr_8h.html#1691b8bd184d40ca6fda255be078fa53" title="Enable/disable error messaging.">wcserr_enable()</a>, as in the example above. If enabled, when an error occurs it is the user's responsibility to free the memory allocated for the error message using <a class="el" href="wcs_8h.html#4ab38bc642c4656f62c43acf84a849f1" title="Destructor for the wcsprm struct.">wcsfree()</a>, <a class="el" href="cel_8h.html#39bb7bf8e545c200191d51884ecfb89b" title="Destructor for the celprm struct.">celfree()</a>, <a class="el" href="prj_8h.html#50db1538981df162709b81be0b2961ab" title="Destructor for the prjprm struct.">prjfree()</a>, etc. Failure to do so before the struct goes out of scope will result in memory leaks (if execution continues beyond the error). </div>
<hr size="1"><address style="text-align: right;"><small>Generated on Mon Apr 2 17:55:24 2012 for WCSLIB 4.13.4 by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.6 </small></address>
</body>
</html>
